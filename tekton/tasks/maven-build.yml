apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: maven-build
spec:
  params:
    - name: CONTEXT_DIR
      type: string
      default: "."
  workspaces:
    - name: source
      description: "Workspace contenant le code source clonÃ©"
    - name: maven-repo
      description: "Cache Maven partagÃ© entre les builds"
  steps:
    - name: build
      image: maven:3.8.6-eclipse-temurin-17
      workingDir: /workspace/source/$(params.CONTEXT_DIR)
      script: |
        #!/bin/sh
        echo "ðŸ“¦ Construction du projet Maven dans $(pwd)..."
        mvn -Dmaven.repo.local=/workspace/maven-repo clean package -DskipTests
