apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: pipeline-microservice-buildah
spec:
  params:
    - name: GIT_URL
      type: string
    - name: GIT_REVISION
      type: string
      default: master
    - name: CONTEXT_DIR
      type: string
    - name: IMAGE
      type: string
  workspaces:
    - name: shared-workspace
    - name: maven-repo
  tasks:
    - name: fetch-repository
      taskRef:
        resolver: cluster
        params:
          - name: kind
            value: task
          - name: name
            value: git-clone
          - name: namespace
            value: openshift-pipelines
      params:
        - name: URL
          value: $(params.GIT_URL)
        - name: REVISION
          value: $(params.GIT_REVISION)
      workspaces:
        - name: output
          workspace: shared-workspace

    - name: mvn-build
      runAfter: [fetch-repository]
      taskRef:
        name: maven-build
      params:
        - name: CONTEXT_DIR
          value: $(params.CONTEXT_DIR)
      workspaces:
        - name: source
          workspace: shared-workspace
        - name: maven-repo
          workspace: maven-repo
